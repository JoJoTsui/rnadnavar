/*
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    Nextflow config file for RNA editing annotation tests
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    Defines test-specific parameters and resource allocations for RNA editing tests
----------------------------------------------------------------------------------------
*/

params {
    // Test-specific parameters
    max_memory                 = '6.GB'
    max_cpus                   = 2
    max_time                   = '6.h'
    
    // RNA editing test parameters
    enable_rna_annotation      = true
    min_rna_support           = 2
    
    // Disable COSMIC/gnomAD annotation for tests (no test databases available)
    enable_cosmic_gnomad_annotation = false
    
    // Test data paths (relative to project root)
    test_rescue_vcf           = "${projectDir}/tests/data/test_rescue.vcf.gz"
    test_rescue_vcf_tbi       = "${projectDir}/tests/data/test_rescue.vcf.gz.tbi"
    test_rediportal_vcf       = "${projectDir}/tests/data/test_rediportal.vcf.gz"
    test_rediportal_vcf_tbi   = "${projectDir}/tests/data/test_rediportal.vcf.gz.tbi"
    test_large_rescue_vcf     = "${projectDir}/tests/data/test_large_rescue.vcf.gz"
    test_large_rescue_vcf_tbi = "${projectDir}/tests/data/test_large_rescue.vcf.gz.tbi"
    
    // Skip time-consuming steps for faster testing
    skip_tools                = 'baserecalibrator,markduplicates'
    
    // Test-specific resource configurations
    rna_annotation_memory     = '2.GB'
    rna_annotation_cpus       = 1
}

process {
    // Resource allocation for RNA editing annotation tests
    withName: 'RNA_EDITING_ANNOTATION' {
        memory = { check_max( 2.GB * task.attempt, 'memory' ) }
        cpus   = { check_max( 1 * task.attempt, 'cpus' ) }
        time   = { check_max( 30.min * task.attempt, 'time' ) }
    }
    
    // Resource allocation for VCF rescue filtering tests
    withName: 'VCF_RESCUE_FILTERING' {
        memory = { check_max( 1.GB * task.attempt, 'memory' ) }
        cpus   = { check_max( 1 * task.attempt, 'cpus' ) }
        time   = { check_max( 15.min * task.attempt, 'time' ) }
    }
    
    // General test process configuration
    withLabel: 'process_test' {
        memory = { check_max( 1.GB * task.attempt, 'memory' ) }
        cpus   = { check_max( 1 * task.attempt, 'cpus' ) }
        time   = { check_max( 10.min * task.attempt, 'time' ) }
    }
}

// Test-specific profiles
profiles {
    rna_editing_test {
        params {
            enable_rna_annotation = true
            min_rna_support      = 2
        }
    }
    
    rna_editing_disabled {
        params {
            enable_rna_annotation = false
        }
    }
    
    rna_editing_performance {
        params {
            enable_rna_annotation = true
            min_rna_support      = 2
        }
        process {
            withName: 'RNA_EDITING_ANNOTATION' {
                memory = { check_max( 4.GB * task.attempt, 'memory' ) }
                cpus   = { check_max( 2 * task.attempt, 'cpus' ) }
                time   = { check_max( 1.h * task.attempt, 'time' ) }
            }
        }
    }
}