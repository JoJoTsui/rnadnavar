/*
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    Nextflow config file for VCF realignment optimization tests
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    Defines test-specific parameters and resource allocations for VCF realignment tests
----------------------------------------------------------------------------------------
*/

params {
    // Test-specific parameters
    max_memory                 = '6.GB'
    max_cpus                   = 2
    max_time                   = '6.h'
    
    // VCF realignment test parameters
    tools                      = 'consensus,rescue'
    step                       = 'realignment'
    
    // Test data paths (relative to project root)
    test_vcf_realignment       = "${projectDir}/tests/data/test_vcf_realignment.vcf.gz"
    test_vcf_realignment_tbi   = "${projectDir}/tests/data/test_vcf_realignment.vcf.gz.tbi"
    
    // Skip time-consuming steps for faster testing
    skip_tools                = 'baserecalibrator,markduplicates'
    
    // Test-specific resource configurations
    vcf_realignment_memory    = '4.GB'
    vcf_realignment_cpus      = 2
}

process {
    // Resource allocation for VCF realignment components
    withName: 'ENHANCED_CRAM2BAM_CONVERSION' {
        memory = { check_max( 2.GB * task.attempt, 'memory' ) }
        cpus   = { check_max( 1 * task.attempt, 'cpus' ) }
        time   = { check_max( 30.min * task.attempt, 'time' ) }
    }
    
    withName: 'VCF2BED' {
        memory = { check_max( 1.GB * task.attempt, 'memory' ) }
        cpus   = { check_max( 1 * task.attempt, 'cpus' ) }
        time   = { check_max( 15.min * task.attempt, 'time' ) }
    }
    
    withName: 'SAMTOOLS_EXTRACT_READ_IDS' {
        memory = { check_max( 2.GB * task.attempt, 'memory' ) }
        cpus   = { check_max( 1 * task.attempt, 'cpus' ) }
        time   = { check_max( 30.min * task.attempt, 'time' ) }
    }
    
    withName: 'PICARD_FILTERSAMREADS' {
        memory = { check_max( 2.GB * task.attempt, 'memory' ) }
        cpus   = { check_max( 1 * task.attempt, 'cpus' ) }
        time   = { check_max( 30.min * task.attempt, 'time' ) }
    }
    
    withName: 'FASTQ_ALIGN_HISAT2' {
        memory = { check_max( 3.GB * task.attempt, 'memory' ) }
        cpus   = { check_max( 2 * task.attempt, 'cpus' ) }
        time   = { check_max( 1.h * task.attempt, 'time' ) }
    }
    
    // General test process configuration
    withLabel: 'process_test' {
        memory = { check_max( 1.GB * task.attempt, 'memory' ) }
        cpus   = { check_max( 1 * task.attempt, 'cpus' ) }
        time   = { check_max( 10.min * task.attempt, 'time' ) }
    }
}

// Test-specific profiles
profiles {
    vcf_realignment_test {
        params {
            tools = 'consensus,rescue'
            step  = 'realignment'
        }
    }
    
    maf_realignment_test {
        params {
            tools = 'consensus'  // MAF-based workflow
            step  = 'realignment'
        }
    }
    
    vcf_realignment_performance {
        params {
            tools = 'consensus,rescue'
            step  = 'realignment'
        }
        process {
            withName: 'ENHANCED_CRAM2BAM_CONVERSION' {
                memory = { check_max( 4.GB * task.attempt, 'memory' ) }
                cpus   = { check_max( 2 * task.attempt, 'cpus' ) }
                time   = { check_max( 1.h * task.attempt, 'time' ) }
            }
            withName: 'FASTQ_ALIGN_HISAT2' {
                memory = { check_max( 6.GB * task.attempt, 'memory' ) }
                cpus   = { check_max( 2 * task.attempt, 'cpus' ) }
                time   = { check_max( 2.h * task.attempt, 'time' ) }
            }
        }
    }
}