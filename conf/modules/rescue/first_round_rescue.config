/*
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    Config file for first-round rescue workflow publishDir overrides
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    Consolidates all first-round rescue outputs (rescued, annotated, filtered VCFs)
    into a single rescue/${meta.id}/ directory, matching the second-round rescue
    output structure in vcf_realignment/rescue/.
    
    This config applies to processes within VCF_RESCUE_POST_PROCESSING subworkflow
    when called from BAM_PROCESSING (first-round rescue), NOT from SECOND_RESCUE_WORKFLOW.
----------------------------------------------------------------------------------------
*/

process {
    // VCF_RESCUE: First-round rescue VCF output
    // Matches: BAM_PROCESSING -> VCF_RESCUE_POST_PROCESSING -> VCF_RESCUE
    withName: '.*:BAM_PROCESSING:.*:VCF_RESCUE$' {
        publishDir = [
            mode: params.publish_dir_mode,
            path: { "${params.outdir}/rescue/${meta.id}/" },
            pattern: "*rescued*.{vcf,vcf.gz,vcf.gz.tbi}",
            saveAs: { filename -> filename.equals('versions.yml') ? null : filename }
        ]
    }
    
    // RNA_EDITING_ANNOTATION: First-round RNA editing annotation output
    // Consolidate into rescue directory instead of annotation/rna_editing/
    withName: '.*:BAM_PROCESSING:.*:RNA_EDITING_ANNOTATION' {
        publishDir = [
            mode: params.publish_dir_mode,
            path: { "${params.outdir}/rescue/${meta.id}/" },
            pattern: "*rna_annotated*.{vcf,vcf.gz,vcf.gz.tbi}",
            saveAs: { filename -> filename.equals('versions.yml') ? null : filename }
        ]
    }
    
    // COSMIC_GNOMAD_ANNOTATION: First-round COSMIC/gnomAD annotation output
    // Consolidate into rescue directory instead of annotation/cosmic_gnomad/
    withName: '.*:BAM_PROCESSING:.*:COSMIC_GNOMAD_ANNOTATION' {
        publishDir = [
            mode: params.publish_dir_mode,
            path: { "${params.outdir}/rescue/${meta.id}/" },
            pattern: "*cosmic_gnomad*.{vcf,vcf.gz,vcf.gz.tbi}",
            saveAs: { filename -> filename.equals('versions.yml') ? null : filename }
        ]
    }
    
    // VCF_RESCUE_FILTER: First-round filtered rescue VCF output
    // Consolidate into rescue directory instead of filtered/
    withName: '.*:BAM_PROCESSING:.*:VCF_RESCUE_FILTER' {
        publishDir = [
            mode: params.publish_dir_mode,
            path: { "${params.outdir}/rescue/${meta.id}/" },
            pattern: "*filtered*.{vcf,vcf.gz,vcf.gz.tbi}",
            saveAs: { filename -> filename.equals('versions.yml') ? null : filename }
        ]
    }
}
